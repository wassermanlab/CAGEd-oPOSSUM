CAGEd-oPOSSUM Installation
==========================

This file contains instructions for installing your own local copy of
CAGEd-oPOSSUM. This is not necessary if you just want to use the CAGEd-oPOSSUM
tool at http://cagedop.cmmt.ubc.ca/CAGEd_oPOSSUM.

CAGEd-oPOSSUM was developed and tested in a Linux environment, specifically
CentOS and Ubuntu. We do not provide any instructions or support if you wish
to install it under Mac OS or Windows.

Please see the DEPENDENCIES file for a list of the prerequisite software
libraries, programs and databases that are required by CAGEd-oPOSSUM.

The steps listed below depend on the type of installation that is required,
i.e. whether you are just planning to run a stand-alone analysis by connecting
to the Wasserman lab databases, or wether you want to do a full install
including the web interface and local copies of the databases.

1) The code is available on GitHub at:

	https://github.com/wassermanlab/CAGEd-oPOSSUM

   It is also available for download as a compressed tar file by clicking
   Download link on the CAGEd-oPOSSUM website at:
   
   	http://cagedop.cmmt.ubc.ca/CAGEd_oPOSSUM/download.html

   Download the code from GitHub or the CAGEd-oPOSSUM website and uncompress
   it as necessary into the local directory you want to use. From here on
   this will be referred to as [$COPHOME].

   If you just want to run the stand-alone analysis script, it is located
   in (path relative to wherever you downloaded/installed the software):

   	[$COPHOME]/scripts/integrated_ssa.pl

   Our own installation required a particular version of perl, so you will
   probably need to modify the perl directive on the first line of the script
   (the line starting with "#!") to reflect your local perl set up.

   You will also probably need to change some settings in the options file:

	[$COPHOME]/lib/OPOSSUM/Web/Opt/BaseOpt.pm

   Particularly you will need to edit some paths to reflect your local setup.
   The 
   Some of the settings are only used when CAGEd-oPOSSUM is run in web context

   This script had *many* options. There is internal documentation describing
   these in a fair amount of detail.

   If you are only planning to do a few analyses at a time, it is acceptable
   to use this script "as is" and have it retrieve necessary data from
   the Wasserman lab databases. However, if you plan to run a lot of analyses
   *PLEASE download and install* your own local copies of the various
   databases used by CAGEd-oPOSSUM. See the "Accessing / Downloading Wasserman
   Lab Databases" section further down. You may also need to do this if
   you find you are haveing any connection issues to our databases from your
   locale.
   
2) Install the HOMER software. This is only required if you wish to use
   the %GC composition and length matched random background option or if
   you want to also run the HOMER motif analysis.

   The HOMER software is available at: http://homer.salk.edu/homer.

   From here on, this document will assume you have installed HOMER under
   /apps/Homer.

3) Install the CAGEd-oPOSSUM databases. This is only necessary if you are
   planning to do a lot of analyses. For light use, you may just connect
   to the Wasserman lab databases. Please see Accessing / Downloading
   Wasserman Lab Databases for details on these two options.

2) For web-based oPOSSUM, set up symbolic links from your webserver htdocs and
   cgi-bin directories. For example if you have installed oPOSSUM in 
   [$COPHOME]/apps/oPOSSUM3 then assuming you are using the Apache server installed in
   /usr/local/apache you would use something like the following:

    $ ln -s [$COPHOME]/apps/oPOSSUM3/cgi-bin /usr/local/apache/cgi-bin/oPOSSUM3
    $ ln -s [$COPHOME]/apps/oPOSSUM3/htdocs /usr/local/apache/htdocs/oPOSSUM3

   You may have to edit your apache config file (httpd.conf) to allow following
   of symbolic links and executing cgi-bin files, e.g.:
    <Directory "/usr/local/apache/cgi-bin">
        AllowOverride FileInfo
        Options FollowSymLinks +ExecCGI +Includes
        Order allow,deny
        Allow from all
    </Directory>

   Alternatively, of course you could copy the oPOSSUM htdocs and cgi-bin
   directories directly into the apache tree.

3) For web-based oPOSSUM, create the following directories:
    htdocs/tmp
    htdocs/results
    logs

   Change the ownership of these directories to that of the user under which the
   web server runs (usually 'nobody' or 'apache') and/or make these directories
   at least read/write/executable to to that user, e.g:

       chown apache:apache htdocs/tmp
       chmod 700 htdocs/tmp

4) For web-based oPOSSUM, edit the configuration constants in the main web
   options file lib/OPOSSUM/Web/Opt/BaseOpt.pm to reflect your specific
   installation.

   Specifically,
   
   * edit the OPOSSUM_HOME constant to point to the top-level directory
     under which oPOSSUM is installed.
   
   * edit the WEB_SERVER_URL constant to point to the top-level URL of your
     oPOSSUM web server.
   
   * edit the WEB_SERVER_HOME constant to point to the top-level directory
     of your apache web server.
   
   * edit the JASPAR DB connection constants, JASPAR_DB_HOST etc.

   There are additional web and standalone oPOSSUM option files under 
   lib/OPOSSUM/Web/Opt/ and lib/OPOSSUM/Opt/ that may also require configuring
   for your specific installation.

   * edit the oPOSSUM DB connection constants, OPOSSUM_DB_HOST etc.
   
   It is also possible to edit other values in these files to reflect
   different default values for the oPOSSUM analysis.

5) Edit the htdocs/index.html file and change specific URL to refer to the
   webserver oPOSSUM is residing on.

6) Edit the htdocs/templates/master.html file and change specific URLs to
   refer to the webserver oPOSSUM is residing on.

7) Install the sorttable.js javascript file from
   http://www.kryogenix.org/code/browser/sorttable into the oPOSSUM
   htdocs/templates subdirectory.



Accessing / Downloading Wasserman Lab Databases
===============================================

If you only plan to run a few analyses, then you may connect directly to the
databases hosted by Wasserman lab servers. However if you plan to do many
analyses, especially if you are planning to run multiple simultaneous analysis,
*PLEASE download and install* your own local copy of these databases. These
two options are described in the relevant sections below.

Accessing the Wasserman Lab Databases Directly
----------------------------------------------
You may connect directly to the CAGEd-oPOSSUM related databases hosted on the
Wasserman lab servers. Each of these databases have a dedicated "read-only"
(i.e. select privileges only) user associated with them. This user does not
require a password.

The table below gives the CAGEd-oPOSSUM database names, the servers they are
hosted on, and the associated "read-only" user:

Database name           DB server host         User
--------------------    -------------------    ---------
JASPAR_2016             vm5.cmmt.ubc.ca        jaspar_r
CAGEd-oPOSSUM3_human	cagedop.cmmt.ubc.ca    cagedop_r
CAGEd-oPOSSUM3_mouse	cagedop.cmmt.ubc.ca    cagedop_r

These connection parameters are set in CAGEd-oPOSSUM options files. To connect
to the Wasserman lab databases, you do not need to change these. If you install local copies of these databases, you may need to modify these parameters. This
is described in the local installation section below.


Downloading and Installing Your Own Copies of the CAGEd-oPOSSUM Databases
-------------------------------------------------------------------------
You must have a local MySQL server set up. Setting up MySQL is beyond the
scope of this document. Please see the MySQL documentation at
http://dev.mysql.com/doc.

To obtain copies of the databases required for CAGEd-oPOSSUM, please use the
Wasserman lab anonymous FTP site, cisreg.ca.

The JASPAR database, "JASPAR_2016" is available for FTP download under:
    pub/JASPAR/JASPAR_2016.sql.gz

As the JASPAR database is relatively small, it is also be possible to obtain
it by downloading it directly from our server with the mysqldump utility using
the connection parameters as described in the table above.

Note: you will probably need to use the --skip-lock-tables option to the
mysqldump command, e.g.:

    mysqldump -h vm5.cmmt.ubc.ca -u jaspar_r JASPAR_2016 --skip-lock-tables > JASPAR_2016.sql

There are two CAGEd-oPOSSUM databases of pre-computed transcription factor
binding sites based on the JASPAR 2016 profiles, one for human and one for
mouse:
    CAGEd_oPOSSUM_human
    CAGEd_oPOSSUM_mouse

Thes are also available for FTP download under:
    pub/CAGEd_oPOSSUM/CAGEd_oPOSSUM_human.sql.gz
    pub/CAGEd_oPOSSUM/CAGEd_oPOSSUM_mouse.sql.gz

*PLEASE DO NOT* use mysqldump to retrieve the CAGEd_oPOSSUM_human and
CAGEd_oPOSSUM_mouse databases from our server as they are quite large,
118GB and 73GB, for human and mouse respectively.

After you have downloaded and uncompressed each of the databases, create
the databases in mysql:

    mysql> create database CAGEd_oPOSSUM_human;
    (etc...)

Load the downloaded database SQL files into you local MySQL installation, e.g.  from the command line:

    $ mysql -u root -p CAGEd< CAGEd_oPOSSUM_human.sql

Enter the MySQL root password when prompted. Note, if you didn't set a MySQL
root password, leave out the -p switch in the command above. Run this for
each of the species databases you plan to use and the JASPAR database.

After you load the databases into your local MySQL database server, you need
to create mysql users, 'jaspar_r' and 'cagedop_r' which have select-only
privileges and don't require a password, e.g.:

    mysql> grant select on JASPAR_2016.* to jaspar_r@'%';
    mysql> grant select on CAGEd_oPOSSUM_human.* to cagedop_r@'%';
    mysql> grant select on CAGEd_oPOSSUM_mouse.* to cagedop_r@'%';

Of course you can configure your local copies differently.

You then need to edit to database configuration files to reflect your
local installation parameters. NOTE that there are two different configuration
files, one for JASPAR and one for the CAGEd-oPOSUM human and mouse databases: 

The JASPAR database settings are located under the "JASPAR DB Access" section
in the file: 

    lib/OPOSSUM/Web/Opt/BaseOpt.pm.

The CAGEd_oPOSUM_human and CAGEd_oPOSUM_mouse database settings are located
under the "CAGEd-oPOSSUM DB Access" settings in the file:

    lib/OPOSSUM/Opt/BaseOpt.pm.
