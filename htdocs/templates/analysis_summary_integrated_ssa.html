<p class="text">
  Your CAGEd-oPOSSUM analysis has been successfully submitted.<br>
  A notification email will be sent to you at the address you provided, <b>[%email%]</b> when the analysis has completed.
</p>

<h3>Selected Parameters</h3>

<br>
<table border="0" cellpadding="2" cellspacing="0">
  <tr>
    <td class="table_title">Job ID:</td>
    <td class="table_text">[%job_id%]</td>
  </tr>

  <tr>
    <td class="table_title">Submitted:</td>
    <td class="table_text">[%submitted_time%]</td>
  </tr>

  <tr></tr>

  <!-- Target TSS summary -->
  [%IF t_tss_type == 'fantom5'%]
    <tr>
      <td class="table_title">Target CAGE peak type:</td>
      <td class="table_text">FANTOM5</td>
    </tr>
    [%IF t_tss_input_method == 'experiment'%]
      <tr>
        <td class="table_title">Target FANTOM5 experiments:</td>
        <td>
          <table>
          [%FOREACH exp = t_experiments%]
            <tr>
              <td class="table_text">FF:[%exp.FF_id()%]</td>
              <td class="table_text">[%exp.name()%]</td>
            </tr>
          [%END%]
          </table>
        </td>
      </tr>

      [%IF t_tag_count%]
      <tr>
        <td class="table_title">Target minimum tag count:</td>
        <td class="table_text">[%t_tag_count%]</td>
      </tr>
      [%END%]

      [%IF t_tpm%]
      <tr>
        <td class="table_title">Target minimum tags per million (TPM):</td>
        <td class="table_text">[%t_tpm%]</td>
      </tr>
      [%END%]

      [%IF t_relative_expression%]
      <tr>
        <td class="table_title">Target minimum relative expression:</td>
        <td class="table_text">[%t_relative_expression%]</td>
      </tr>
      [%END%]
    [%ELSIF t_tss_input_method == 'upload'%]
      <tr>
        <td class="table_title">Target FANTOM5 CAGE peak names file:</td>
        <td class="table_text">[%t_user_tss_names_file%]</td>
      </tr>
    [%ELSIF t_tss_input_method == 'paste'%]
      <!-- Perhaps give a count of the number of peaks  pasted? -->
      <tr>
        <td class="table_title">Target FANTOM5 CAGE peak names:</td>
        <td class="table_text">Pasted</td>
      </tr>
    [%END%]
  [%ELSIF t_tss_type == 'custom'%]
    <tr>
      <td class="table_title">Target CAGE peak type:</td>
      <td class="table_text">User defined</td>
    </tr>
    [%IF t_tss_input_method == 'upload'%]
      <tr>
        <td class="table_title">Target CAGE peaks uploaded file:</td>
        <td class="table_text">[%t_user_custom_tss_file%]</td>
      </tr>
    [%ELSIF t_tss_input_method == 'paste'%]
      <!-- Perhaps give a count of the number of regions pasted? -->
      <tr>
        <td class="table_title">Target CAGE peaks:</td>
        <td class="table_text">Pasted</td>
      </tr>
    [%END%]
  [%END%]

  <!-- Target TSS filters summary -->
  [%IF t_tss_type == 'fantom5'%]
    <tr>
      <td class="table_title">Target TSS only filter provided:</td>
      [%IF t_use_tss_only == 1%]
        <td class="table_text">Yes</td>
      [%ELSE%]
        <td class="table_text">No</td>
      [%END%]
    </tr>
  [%END%]

  <!-- Applies to both FANTOM5 and custom CAGE peaks -->
  [%IF t_gene_ids_input_method == 'upload'%]
    <tr>
      <td class="table_title">Target associated gene IDs filter file:</td>
      <td class="table_text">[%t_user_gene_ids_file%]</td>
    </tr>
  [%ELSIF t_gene_ids_input_method == 'paste'%]
    <tr>
      <td class="table_title">Target Associated gene IDs filter:</td>
      <td class="table_text">Pasted</td>
    </tr>
  [%END%]

  [%IF t_filter_regions_input_method == 'upload'%]
    <tr>
      <td class="table_title">Target filtering regions file:</td>
      <td class="table_text">[%t_user_filter_regions_file%]</td>
    </tr>
  [%ELSIF t_filter_regions_input_method == 'paste'%]
    <tr>
      <td class="table_title">Target filtering regions:</td>
      <td class="table_text">Pasted</td>
    </tr>
  [%END%]

  <tr></tr>

  <!-- Background TSS summary -->
  [%IF b_tss_type == 'fantom5'%]
    <tr>
      <td class="table_title">Background CAGE peak type:</td>
      <td class="table_text">FANTOM5</td>
    </tr>
    [%IF b_tss_input_method == 'experiment'%]
      <tr>
        <td class="table_title">Background FANTOM5 experiments:</td>
        <td>
          <table>
          [%FOREACH exp = b_experiments%]
            <tr>
              <td class="table_text">FF:[%exp.FF_id()%]</td>
              <td class="table_text">[%exp.name()%]</td>
            </tr>
          [%END%]
          </table>
        </td>
      </tr>

      [%IF b_tag_count%]
      <tr>
        <td class="table_title">Background minimum tag count:</td>
        <td class="table_text">[%b_tag_count%]</td>
      </tr>
      [%END%]

      [%IF b_tpm%]
      <tr>
        <td class="table_title">Background minimum tags per million (TPM):</td>
        <td class="table_text">[%b_tpm%]</td>
      </tr>
      [%END%]

      [%IF b_relative_expression%]
      <tr>
        <td class="table_title">Background minimum relative expression:</td>
        <td class="table_text">[%b_relative_expression%]</td>
      </tr>
      [%END%]
    [%ELSIF b_tss_input_method == 'upload'%]
      <tr>
        <td class="table_title">Background FANTOM5 CAGE peak names file:</td>
        <td class="table_text">[%b_user_tss_names_file%]</td>
      </tr>
    [%ELSIF b_tss_input_method == 'paste'%]
      <!-- Perhaps give a count of the number of peaks  pasted? -->
      <tr>
        <td class="table_title">Background FANTOM5 CAGE peak names:</td>
        <td class="table_text">Pasted</td>
      </tr>
    [%END%]
  [%ELSIF b_tss_type == 'custom'%]
    <tr>
      <td class="table_title">Background CAGE peak type:</td>
      <td class="table_text">User defined</td>
    </tr>
    [%IF b_tss_input_method == 'upload'%]
      <tr>
        <td class="table_title">Background user CAGE peaks file:</td>
        <td class="table_text">[%b_user_custom_tss_file%]</td>
      </tr>
    [%ELSIF b_tss_input_method == 'paste'%]
      <!-- Perhaps give a count of the number of regions pasted? -->
      <tr>
        <td class="table_title">Background user CAGE peaks:</td>
        <td class="table_text">Pasted</td>
      </tr>
    [%END%]
  [%END%]

  <!-- Background TSS filters summary -->
  [%IF b_tss_type == 'fantom5'%]
    <tr>
      <td class="table_title">Background TSS only filter provided:</td>
      [%IF b_use_tss_only == 1%]
        <td class="table_text">Yes</td>
      [%ELSE%]
        <td class="table_text">No</td>
      [%END%]
    </tr>
  [%END%]

  <!-- Applies to both FANTOM5 and custom CAGE peaks -->
  [%IF b_gene_ids_input_method == 'upload'%]
    <tr>
      <td class="table_title">Background associated gene IDs filter file:</td>
      <td class="table_text">[%b_user_gene_ids_file%]</td>
    </tr>
  [%ELSIF b_gene_ids_input_method == 'paste'%]
    <tr>
      <td class="table_title">Background associated gene IDs filter:</td>
      <td class="table_text">Pasted</td>
    </tr>
  [%END%]

  [%IF b_filter_regions_input_method == 'upload'%]
    <tr>
      <td class="table_title">Background filtering regions file:</td>
      <td class="table_text">[%b_user_filter_regions_file%]</td>
    </tr>
  [%ELSIF b_filter_regions_input_method == 'paste'%]
    <tr>
      <td class="table_title">Background filtering regions provided:</td>
      <td class="table_text">Yes</td>
    </tr>
  [%END%]

  <tr></tr>

  <!-- TFBS profile selection summary -->
  [%IF tf_select_criteria == 'jaspar'%]
    [%IF collection%]
      <tr>
        <td class="table_title">JASPAR collection:</td>
        <td class="table_text">[%collection%]</td>
      </tr>
    [%END%]

    [%IF tf_select_method == 'min_ic'%]
      [%IF tax_groups%]
        <tr>
          <td class="table_title">Taxonomic supergroup(s):</td>
          <td class="table_text">
            [%FOREACH tax_group = tax_groups%][%tax_group%]&nbsp;[%END%]
          </td>
        </tr>
      [%END%]
      [%IF min_ic%]
        <tr>
          <td class="table_title">Min. IC:</td>
          <td class="table_text">[%min_ic%] bits</td>
        </tr>
      [%END%]
    [%ELSIF tf_select_method == 'specific'%]
      [%matrix_list = tf_set.get_matrix_list('name')%]
      <tr>
        <td class="table_title">TFBS profiles:</td>
        <td class="table_text">
        [%FOREACH matrix = matrix_list%][%matrix.name()%][%END%]
        </td>
      </tr>
    [%END%] <!-- if tf_select_criteria == ... -->
  [%ELSIF tf_select_criteria == 'custom'%]
    <tr>
      <td class="table_title">TFBS profile uploaded file:</td>
      <td class="table_text">[%user_tfbs_matrix_file%]</td>
    </tr>
  [%END%] <!-- if collection -->

  <tr>
    <td class="table_title">Matrix score threshold:</td>
    <td class="table_text">[%threshold * 100%]%</td>
  </tr>

  <tr>
    <td class="table_title">TSS flanking sequence size:</td>
    <td class="table_text">[%upstream_bp%] / [%downstream_bp%]</td>
  </tr>

  [%IF result_sort_by == 'zscore'%]
    [%display_sort_by = 'Z-score'%]
  [%ELSIF result_sort_by == 'fisher_p_value'%]
    [%display_sort_by = 'Fisher score'%]
  [%ELSIF result_sort_by == 'ks_p_value'%]
    [%display_sort_by = 'KS score'%]
  [%ELSE%]
    [%display_sort_by = result_sort_by%]
  [%END%]
  <tr>
    <td class="table_title">Results returned:</td>
    [%IF result_type == 'top_x_results'%]
      [%IF num_display_results == 'All'%]
        <td class="table_text">All results sorted by [%display_sort_by%]</td>
      [%ELSE%]
        <td class="table_text">Top [%num_display_results%] results by [%display_sort_by%]</td>
      [%END%]
    [%ELSIF result_type == 'significant_hits'%]
      <td class="table_text">All results with a Z-score >= [%zscore_cutoff%] and a Fisher score >= [%fisher_cutoff%] and a K-S p-value <= [%ks_cutoff%] sorted by [%display_sort_by%]</td>
    [%END%]
  </tr>

  <tr></tr>

  <tr>
    <td class="table_title">The results will be sent to the following email:</td>
    <td class="table_text">[%email%]</td>
  </tr>

</table>
